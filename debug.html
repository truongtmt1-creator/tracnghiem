<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Tool - T·∫£i ƒê·ªÅ Thi</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background-color: #f4f4f9; }
        .container { max-width: 900px; margin: auto; background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        h2 { color: #007bff; }
        .status { margin-bottom: 20px; padding: 10px; border: 1px solid #ccc; border-radius: 4px; font-weight: bold; }
        #output { white-space: pre-wrap; background-color: #eee; padding: 15px; border-radius: 4px; max-height: 600px; overflow-y: auto; }
        .question-item { border: 1px solid #ddd; padding: 10px; margin-bottom: 10px; border-left: 5px solid #007bff; }
        .answer { color: green; font-weight: bold; }
    </style>
</head>
<body>

    <div class="container">
        <h2>üõ†Ô∏è Debug Tool: T·∫£i ƒê·ªÅ Thi Tr·ª±c Ti·∫øp</h2>
        <p>Ki·ªÉm tra k·∫øt n·ªëi v√† d·ªØ li·ªáu c√¢u h·ªèi t·ª´ Google Sheet (ID: `1dACqTTznqndOqWl-QOyvLNqFtEyRLXuowj6U2QWFfMQ`, Sheet: `Khoi7`).</p>
        <div id="status-message" class="status">ƒêang k·∫øt n·ªëi...</div>
        
        <button onclick="fetchQuestions()">B·∫ÆT ƒê·∫¶U T·∫¢I & HI·ªÇN TH·ªä C√ÇU H·ªéI</button>

        <h3 style="margin-top: 30px;">K·∫øt qu·∫£ (D·ªØ li·ªáu th√¥):</h3>
        <pre id="output"></pre>

        <h3 style="margin-top: 30px;">Hi·ªÉn th·ªã C√¢u h·ªèi (N·∫øu th√†nh c√¥ng):</h3>
        <div id="quiz-display"></div>
    </div>

    <script>
        // C·∫ßn thay th·∫ø b·∫±ng URL Web App m·ªõi nh·∫•t v√† ƒëang ho·∫°t ƒë·ªông c·ªßa b·∫°n
        const GAS_WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbx9Kc3Zv77wTfBSQcAGbtaZykSDIIMi1bW3CDRHHs6xJu_AWlRPw1UBaaR2G5ROY3F9/exec';
        
        // C√ÅC THAM S·ªê C·ªê ƒê·ªäNH ƒê·ªÇ KI·ªÇM L·ªñI
        const DEBUG_KHOI = '7';
        const DEBUG_BAIKT_ID = 'KT7GK1'; // ID b√†i ki·ªÉm tra gi·∫£ ƒë·ªãnh/c√≥ th·∫≠t

        const statusDisplay = document.getElementById('status-message');
        const outputDisplay = document.getElementById('output');
        const quizDisplay = document.getElementById('quiz-display');


        async function fetchQuestions() {
            statusDisplay.textContent = 'ƒêang g·ª≠i y√™u c·∫ßu ƒë·∫øn Google Apps Script...';
            outputDisplay.textContent = 'Ch·ªù ph·∫£n h·ªìi...';
            quizDisplay.innerHTML = '';

            try {
                // 1. X√¢y d·ª±ng URL v·ªõi c√°c tham s·ªë c·ªë ƒë·ªãnh
                const url = new URL(GAS_WEB_APP_URL);
                url.searchParams.append('action', 'getQuiz');
                url.searchParams.append('Khoi', DEBUG_KHOI);
                url.searchParams.append('BaiKT_ID', DEBUG_BAIKT_ID);

                // 2. G·ª≠i y√™u c·∫ßu
                const response = await fetch(url.toString(), {
                    method: 'GET',
                    mode: 'cors'
                });

                if (!response.ok) {
                    throw new Error(`L·ªói HTTP! Status: ${response.status}`);
                }
                
                const data = await response.json();
                outputDisplay.textContent = JSON.stringify(data, null, 2);

                if (data.error) {
                    statusDisplay.style.backgroundColor = '#ffcccc';
                    statusDisplay.textContent = `üö® L·ªói t·ª´ Apps Script: ${data.error}`;
                    return;
                }

                if (data.questions && data.questions.length > 0) {
                    statusDisplay.style.backgroundColor = '#ccffcc';
                    statusDisplay.textContent = `‚úÖ T·∫£i th√†nh c√¥ng! T√¨m th·∫•y ${data.questions.length} c√¢u h·ªèi.`;
                    renderQuizData(data.questions);
                } else {
                    statusDisplay.style.backgroundColor = '#fff7cc';
                    statusDisplay.textContent = '‚ö†Ô∏è T·∫£i th√†nh c√¥ng, nh∆∞ng kh√¥ng c√≥ c√¢u h·ªèi n√†o ƒë∆∞·ª£c ch·ªçn (Ki·ªÉm tra sheet C·∫•u h√¨nh v√† Khoi7).';
                }

            } catch (error) {
                statusDisplay.style.backgroundColor = '#ffcccc';
                statusDisplay.textContent = `‚ùå L·ªói k·∫øt n·ªëi/ph√¢n t√≠ch: ${error.message}`;
                outputDisplay.textContent = `Ki·ªÉm tra l·∫°i GAS_WEB_APP_URL v√† tri·ªÉn khai Web App. Chi ti·∫øt l·ªói: ${error.message}`;
                console.error("Debug Error:", error);
            }
        }

        function renderQuizData(questions) {
            quizDisplay.innerHTML = '';
            questions.forEach((q, index) => {
                const qDiv = document.createElement('div');
                qDiv.className = 'question-item';

                let optionsHtml = '';
                const optionKeys = ['Dap_an_A', 'Dap_an_B', 'Dap_an_C', 'Dap_an_D'];

                optionKeys.forEach((key, opIndex) => {
                    if (q[key]) { 
                        const optionChar = String.fromCharCode(65 + opIndex);
                        optionsHtml += `<p>${optionChar}. ${q[key]}</p>`;
                    }
                });
                
                // Hi·ªÉn th·ªã ƒë√°p √°n ƒë√∫ng (ƒë√£ ƒë∆∞·ª£c m√£ h√≥a l√† Correct_Answer)
                const correctAnswer = q.Correct_Answer || 'N/A';
                
                qDiv.innerHTML = `
                    <h4>C√¢u ${index + 1}. (ID: ${q.ID}) - ${q.Tieu_de}</h4>
                    ${optionsHtml}
                    <p class="answer">ƒê√°p √°n ƒë√∫ng (Debug): ${correctAnswer}</p>
                `;
                quizDisplay.appendChild(qDiv);
            });
        }
    </script>
</body>
</html>